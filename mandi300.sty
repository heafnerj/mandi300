%%
%% This is file `mandi.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% mandi.dtx  (with options: `package')
%% 
%% Copyright (C) 2021 by Paul J. Heafner <heafnerj@gmail.com>
%% ---------------------------------------------------------------------------
%% This  work may be  distributed and/or modified  under the conditions of the
%% LaTeX Project Public  License, either  version 1.3  of this  license or (at
%% your option) any later version. The latest version of this license is in
%%            http://www.latex-project.org/lppl.txt
%% and  version 1.3 or  later is  part of  all distributions of  LaTeX version
%% 2005/12/01 or later.
%% 
%% This work has the LPPL maintenance status `maintained'.
%% 
%% The Current Maintainer of this work is Paul J. Heafner.
%% 
%%  This work consists of the files mandi.dtx
%%                                  mandi.ins
%%                                  mandi.pdf
%%                                  README
%% 
%%  and includes the derived files  mandi.sty
%%                                  vdemo.py.
%% ---------------------------------------------------------------------------
%% 
%  NOTE: THE NUMBERS WILL NOT BE IN THE FINAL PACKAGE NAME!
\def\mandi@Version{3.0.0a}
\def\mandi@Date{2021-01-11}
\ProvidesPackage{mandi300}[\mandi@Date\space v\mandi@Version\space Macros for physics and astronomy]
\NeedsTeXFormat{LaTeX2e}[1999/12/01]

% Package Version
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand*{\mandiversion}{v\mandi@Version\space dated \mandi@Date}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Fonts and ISO 80000-2 Notation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% unicode-math loads fontspec and xparse
\RequirePackage{unicode-math}
\unimathsetup{math-style=ISO}
\unimathsetup{warnings-off={mathtools-colon,mathtools-overbracket}}
\setmathfont[Scale=MatchLowercase]{TeX Gyre DejaVu Math} % Good g everywhere. Based on Arev.
% Borrow \mathscr and \mathbfscr from XITS Math
%  See https://tex.stackexchange.com/a/120073/218142
\setmathfont[Scale=MatchLowercase,range={\mathscr,\mathbfscr}]{XITS Math}
% Get original and bold \mathcal font
%  See https://tex.stackexchange.com/a/21742/218142
\setmathfont[Scale=MatchLowercase,range={\mathcal,\mathbfcal},StylisticSet=1]{XITS Math}
% Borrow Greek letters from Latin Modern Math
\setmathfont[Scale=MatchLowercase,range=    it/{greek,Greek}]{Latin Modern Math}
\setmathfont[Scale=MatchLowercase,range=  bfit/{greek,Greek}]{Latin Modern Math}
\setmathfont[Scale=MatchLowercase,range=    up/{greek,Greek}]{Latin Modern Math}
\setmathfont[Scale=MatchLowercase,range=  bfup/{greek,Greek}]{Latin Modern Math}
\setmathfont[Scale=MatchLowercase,range=bfsfup/{greek,Greek}]{Latin Modern Math}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Third Party Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{amsmath}                   % AMS goodness (don't load amssymb or amsfonts)
\RequirePackage{eso-pic}                   % needed for \hilite
\RequirePackage[g]{esvect}                 % needed for nice vector arrow, style g
\RequirePackage{kvoptions}                 % needed for keyvals
\SetupKeyvalOptions{%
  family=mandi,%
  prefix=mandi@%
}%
\RequirePackage{array}  % needed for \chkquantity
\RequirePackage{listings}                  % needed for program listings
\RequirePackage{makebox}                   % needed for consistent \dirvect; \makebox
\RequirePackage{mathtools}                 % needed for paired delimiters; extends amsmath
\RequirePackage{nicematrix}                % needed for column and row vectors
\RequirePackage{realboxes}                 % needed for coloring inline listings; \Colorbox
\RequirePackage{tensor}                    % needed for index notation
\RequirePackage{tikz}                      % needed for \hilite
\usetikzlibrary{shapes,fit,tikzmark}       % needed for \hilite
\RequirePackage{xargs}                     % needed for the unit engine; \newcommandx
\RequirePackage{hyperref}                  % load last
% xcolor                                   % loaded by listings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% We need to tweak the esvect fonts to get the correct font size.
%  Code provided by @egreg.
%  See https://tex.stackexchange.com/a/566676
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\DeclareFontFamily{U}{esvect}{}
\DeclareFontShape{U}{esvect}{m}{n}{%
  <-5.5> vect5
  <5.5-6.5> vect6
  <6.5-7.5> vect7
  <7.5-8.5> vect8
  <8.5-9.5> vect9
  <9.5-> vect10
}{}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define Package mandi Options
%  There aren't as many as before because of ISO 80000-2 notation.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\DeclareBoolOption[false]{baseunits}      % use base units
\DeclareBoolOption[false]{derivedunits}   % use derived units
\DeclareBoolOption[true]{alternateunits} % use alternate units
\DeclareBoolOption[false]{rotradians}     % use radians in rotational quantities
\DeclareBoolOption[false]{exactconstants} % use exact constants
\ProcessKeyvalOptions*

\newcommand*{\mandisetup}{%
  \kvsetkeys{mandi}%
}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Standard Package Messages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%\AtBeginDocument{%
%%\typeout{}
%%\typeout{mandi: You're using mandi version \mandiversion.}
%%\typeout{}
%%}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% GlowScript and VPython Code Listings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% We want to highlight numbers.
%  Based on a solution by Ulrike Fischer.
%  See https://tex.stackexchange.com/a/570717/218142
\directlua{%
 luaotfload.add_colorscheme("colordigits",
   {["8000FF"] = {"one","two","three","four","five","six","seven","eight","nine","zero"}})
}%
\newfontfamily\colordigits{DejaVuSansMono}[RawFeature={color=colordigits}]

%  See https://tex.stackexchange.com/a/529421/218142
\newfontfamily{\gsfontfamily}{DejaVuSansMono}    % new font for listings
\definecolor{gsbggray}     {rgb}{0.90,0.90,0.90} % background gray
\definecolor{gsgray}       {rgb}{0.30,0.30,0.30} % gray
\definecolor{gsgreen}      {rgb}{0.00,0.60,0.00} % green
\definecolor{gsorange}     {rgb}{0.80,0.45,0.12} % orange
\definecolor{gspeach}      {rgb}{1.00,0.90,0.71} % peach
\definecolor{gspearl}      {rgb}{0.94,0.92,0.84} % pearl
\definecolor{gsplum}       {rgb}{0.74,0.46,0.70} % plum
\lstdefinestyle{vpython}{%                       % style for listings
  backgroundcolor=\color{gsbggray},%             % background color
  basicstyle=\colordigits\footnotesize,%         % default style
  breakatwhitespace=true%                        % break at whitespace
  breaklines=true,%                              % break long lines
  captionpos=b,%                                 % position caption
  classoffset=1,%                                % STILL DON'T UNDERSTAND THIS
  commentstyle=\color{gsgray},%                  % font for comments
  deletekeywords={print},%                       % delete keywords from the given language
  emph={self,cls,@classmethod,@property},%       % words to emphasize
  emphstyle=\color{gsorange}\itshape,%           % font for emphasis
  escapeinside={(*@}{@*)},%                      % add LaTeX within your code
  frame=tb,%                                     % frame style
  framerule=2.0pt,%                              % frame thickness
  framexleftmargin=5pt,%                         % extra frame left margin
  %identifierstyle=\sffamily,%                    % style for identifiers
  keywordstyle=\gsfontfamily\color{gsplum},%     % color for keywords
  language=Python,%                              % select language
  linewidth=\linewidth,%                         % width of listings
  morekeywords={%                                % VPython/GlowScript specific keywords
    __future__,abs,acos,align,ambient,angle,append,append_to_caption,%
    append_to_title,arange,arrow,asin,astuple,atan,atan2,attach_arrow,%
    attach_trail,autoscale,axis,background,billboard,bind,black,blue,border,%
    bounding_box,box,bumpaxis,bumpmap,bumpmaps,camera,canvas,caption,capture,%
    ceil,center,clear,clear_trail,click,clone,CoffeeScript,coils,color,combin,%
    comp,compound,cone,convex,cos,cross,curve,cyan,cylinder,data,degrees,del,%
    delete,depth,descender,diff_angle,digits,division,dot,draw_complete,%
    ellipsoid,emissive,end_face_color,equals,explog,extrusion,faces,factorial,%
    False,floor,follow,font,format,forward,fov,frame,gcurve,gdisplay,gdots,%
    get_library,get_selected,ghbars,global,GlowScript,graph,graphs,green,gvbars,%
    hat,headlength,headwidth,height,helix,hsv_to_rgb,index,interval,keydown,%
    keyup,label,length,lights,line,linecolor,linewidth,logx,logy,lower_left,%
    lower_right,mag,mag2,magenta,make_trail,marker_color,markers,material,%
    max,min,mouse,mousedown,mousemove,mouseup,newball,norm,normal,objects,%
    offset,one,opacity,orange,origin,path,pause,pi,pixel_to_world,pixels,plot,%
    points,pos,pow,pps,print,print_function,print_options,proj,purple,pyramid,%
    quad,radians,radius,random,rate,ray,read_local_file,readonly,red,redraw,%
    retain,rgb_to_hsv,ring,rotate,round,scene,scroll,shaftwidth,shape,shapes,%
    shininess,show_end_face,show_start_face,sign,sin,size,size_units,sleep,%
    smooth,space,sphere,sqrt,start,start_face_color,stop,tan,text,textpos,%
    texture,textures,thickness,title,trail_color,trail_object,trail_radius,%
    trail_type,triangle,trigger,True,twist,unbind,up,upper_left,upper_right,%
    userpan,userspin,userzoom,vec,vector,vertex,vertical_spacing,visible,%
    visual,vpython,VPython,waitfor,white,width,world,xtitle,yellow,yoffset,%
    ytitle%
  },%
  morekeywords={print,None,TypeError},%          % additional keywords
  morestring=[b]{"""},%                          % treat triple quotes as strings
  numbers=left,%                                 % where to put line numbers
  numbersep=10pt,%                               % how far line numbers are from code
  numberstyle=\bfseries\tiny,%                   % set to 'none' for no line numbers
  showstringspaces=false,%                       % show spaces in strings
  showtabs=false,%                               % show tabs within strings
  stringstyle=\gsfontfamily\color{gsgreen},%     % color for strings
  upquote=true,%                                 % how to typeset quotes
}%
% A new, more intelligent glowscriptblock environment.
%  Code provided by Ulrich Diez.
%  See https://tex.stackexchange.com/a/565167/218142
%  To display a VPython program, omit the optional link.
%\makeatletter
% Infrastructure for "hyperref-normalizing" an optional argument of a \lstnewenvironment:
\begingroup
  \catcode`\^^A=14 %
  \catcode`\^^M\active^^A
  \catcode`\%\active^^A
  \@ifdefinable\hyper@@normaliseoptarg{^^A
    \gdef\hyper@@normaliseoptarg#1#2#3]{^^A
      \edef\Hy@tempa{^^A
        \endgroup\noexpand#1[{\Hy@RemovePercentCr#3%^^M\@nil}]^^A
      }^^A
      \Hy@tempa^^A
    }^^A
  }^^A
\endgroup
\newcommand\MY@exchange[2]{#2#1}%
\expandafter\newcommand\expandafter*\expandafter\hyper@normaliseoptarg\expandafter{%
  \romannumeral0%
  \expandafter\MY@exchange\expandafter{\hyper@normalise}{%
    \@firstofone{\expandafter} %
    \MY@exchange{\let\hyper@@normalise=\hyper@@normaliseoptarg}%
  }%
}%
\newcommand\lstenv@testhyper@normalizeopt[2]{%
  \@ifnextchar[{\catcode \active 5\relax\hyper@normaliseoptarg{\lstenv@testopt\noexpand#1{#2}}}%
               {\hyper@normaliseoptarg{#1}[{#2}]}%
}%
% end of Infrastructure for "hyperref-normalizing" an optional argument of a \lstnewenvironment.

\newsavebox\glowscriptblockTempBox
\newcommand\glowscriptblockURL{}%
\newcommand\glowscriptblockWrapInPartopsep[1]{%
   \vskip\partopsep#1\vskip\partopsep
}%
\lstnewenvironment{glowscriptblock}[3][]{%
  \newpage % Each listing begins on a new page.
  \gdef\glowscriptblockURL{#1}%
  \setbox\glowscriptblockTempBox\hbox{\begingroup\aftergroup}%
  \lstset{style=vpython,caption={#2},label={#3}}%
}{%
  \endgroup
  \ifx\glowscriptblockURL\empty\else\hypersetup{hidelinks}\fi
  \ifvmode\endgraf\expandafter\glowscriptblockWrapInPartopsep\else\endgraf\expandafter\@firstofone\fi
  {%
    \vskip\topsep
    \noindent
    \ifcat $\detokenize\expandafter\expandafter\expandafter{\expandafter\@firstoftwo\glowscriptblockURL{}.}$%
    \expandafter\@firstoftwo\else\expandafter\@secondoftwo\fi
    {\@firstofone}%
    {\expandafter\href\expandafter{\glowscriptblockURL}}%
    {\usebox{\glowscriptblockTempBox}}%
    \endgraf
    \vskip\topsep
  }%
}%
% Make sure hyperref's \href gets its argument "hyperref-normalized" by replacing
% \lstenv@testopt with \lstenv@testhyper@normalizeopt in the definition of \glowscriptblock@.
\expandafter\renewcommand\expandafter*\expandafter\glowscriptblock@\expandafter{%
  \romannumeral0%
  \expandafter\MY@exchange\expandafter{%
    \csname\string\glowscriptblock@\endcsname{}%<-the default for the opt arg is between these braces. 
                                               %The default is empty.
  }{%
    \ifx\protect\@typeset@protect
      \expandafter\lstenv@testhyper@normalizeopt
    \else
      \@x@protect\glowscriptblock@ 
    \fi
  }%
}%
%\makeatother
% Creating aliases for environment is generally not thought to be a good idea, so I won't
% create a vpythonblock alias for glowscriptblock. Just omit the optional parameter for 
% typesetting a VPython block of code.

% GlowScript inline. Listing should be shorter than one line.
%  See https://tex.stackexchange.com/q/408878/218142
\newcommand*{\glowscriptline}[1]{\Colorbox{gsbggray}{\lstinline[style=vpython]{#1}}}
% An alias.
\newcommand*{\vpythonline}{\glowscriptline}

% VPython file input.
%  There's no semantic need for an alias since GlowScript programs aren't saved locally.
\newcommand*{\vpythonfile}[3]{%
  \newpage % Each listing begins on a new page.
  \lstinputlisting[style=vpython,caption={#1},label={#2}]{#3}
}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Unit Engine
%  All single letter macros are gone. I basically absorbed and
%   adapted the now defunct SIunits package.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand*{\per}{\ensuremath{/}}
\newcommand*{\usk}{\ensuremath{\cdot}}
\newcommand*{\unit}[2]{\ensuremath{{#1}\;{#2}}}
\newcommand*{\ampere}{\ensuremath{\symup{A}}}
\newcommand*{\arcminute}{\ensuremath{'}}
\newcommand*{\arcsecond}{\ensuremath{''}}
\newcommand*{\atomicmassunit}{\ensuremath{\symup{u}}}
\newcommand*{\candela}{\ensuremath{\symup{cd}}}
\newcommand*{\coulomb}{\ensuremath{\symup{C}}}
\newcommand*{\degree}{\ensuremath{^{\circ}}}
\newcommand*{\electronvolt}{\ensuremath{\symup{eV}}}
\newcommand*{\farad}{\ensuremath{\symup{F}}}
\newcommand*{\henry}{\ensuremath{\symup{H}}}
\newcommand*{\hertz}{\ensuremath{\symup{Hz}}}
\newcommand*{\hour}{\ensuremath{\symup{h}}}
\newcommand*{\joule}{\ensuremath{\symup{J}}}
\newcommand*{\kelvin}{\ensuremath{\symup{K}}}
\newcommand*{\kilogram}{\ensuremath{\symup{kg}}}
\newcommand*{\meter}{\ensuremath{\symup{m}}}
\newcommand*{\metre}{\meter}
\newcommand*{\minute}{\ensuremath{\symup{min}}}
\newcommand*{\mole}{\ensuremath{\symup{mol}}}
\newcommand*{\newton}{\ensuremath{\symup{N}}}
\newcommand*{\ohm}{\ensuremath{\symup\Omega}}
\newcommand*{\pascal}{\ensuremath{\symup{Pa}}}
\newcommand*{\radian}{\ensuremath{\symup{rad}}}
\newcommand*{\second}{\ensuremath{\symup{s}}}
\newcommand*{\siemens}{\ensuremath{\symup{S}}}
\newcommand*{\steradian}{\ensuremath{\symup{sr}}}
\newcommand*{\tesla}{\ensuremath{\symup{T}}}
\newcommand*{\volt}{\ensuremath{\symup{V}}}
\newcommand*{\watt}{\ensuremath{\symup{W}}}
\newcommand*{\weber}{\ensuremath{\symup{Wb}}}
\newcommand*{\square}[1]{\ensuremath{{#1}^2}}               % prefix   2
\newcommand*{\cubic}[1]{\ensuremath{{#1}^3}}                % prefix   3
\newcommand*{\quartic}[1]{\ensuremath{{#1}^4}}              % prefix   4
\newcommand*{\reciprocal}[1]{\ensuremath{{#1}^{-1}}}        % prefix  -1
\newcommand*{\reciprocalsquare}[1]{\ensuremath{{#1}^{-2}}}  % prefix  -2
\newcommand*{\reciprocalcubic}[1]{\ensuremath{{#1}^{-3}}}   % prefix  -3
\newcommand*{\reciprocalquartic}[1]{\ensuremath{{#1}^{-4}}} % prefix  -4
\newcommand*{\squared}{\ensuremath{^2}}                     % postfix  2
\newcommand*{\cubed}{\ensuremath{^3}}                       % postfix  3
\newcommand*{\quarted}{\ensuremath{^4}}                     % postfix  4
\newcommand*{\reciprocaled}{\ensuremath{^{-1}}}             % postfix -1
\newcommand*{\reciprocalsquared}{\ensuremath{^{-2}}}        % postfix -2
\newcommand*{\reciprocalcubed}{\ensuremath{^{-3}}}          % postfix -3
\newcommand*{\reciprocalquarted}{\ensuremath{^{-4}}}        % postfix -4
\newcommand*{\emptyunit}{\ensuremath{\mdlgwhtsquare}}
%  This is the actual unit engine that lets mandi "know" the unit of every
%   physical quantity we define.
%   Code provided by Ulrich Diez.
%%---------------------------------------------------------------
%% Input:   \Name <non embraced-tokens>{ControlSequenceName}
%% yields:  <non embraced-tokens>\ControlSequenceName
%% whereby <non embraced-tokens> can be empty
%% or can be something like \newcommand or \renewcommand or \long\def
%% or whatsoever.
%%%...............................................................
\newcommand*\mi@exchangeargs[2]{#2#1}%
\newcommand*\mi@name{}%
\long\def\mi@name#1#{\romannumeral0\mi@innername{#1}}%
\newcommand*\mi@innername[2]{%
  \expandafter\mi@exchangeargs\expandafter{\csname#2\endcsname}{#1}
}%
%%---------------------------------------------------------------
%% \Forkifnull - Macro to check if argument doesn't contain any
%%               token/is empty/is null:
%% \Forkifnull{<tokens>}%
%%            {<action if <tokens>-Arg is empty/null>}%
%%            {<action if <tokens>-Arg contains tokens}
%%...............................................................
\begingroup %<-keep \makeatletter "local"/restricted to a new current scope.
            % The scope will be closed and thus one will return to the
            % usual catcode-régime when - right after reading and tokenizing
            % it under @-other-catcode-régime - \@firstofone "spits out"
            % its argument whose first token will be \endgroup:
%\makeatletter
\@firstofone{%
  \endgroup
  \newcommand*\mi@forkifnull[3]{%
    \romannumeral\iffalse{\fi\expandafter\@secondoftwo\expandafter%
    {\expandafter{\string#1}\expandafter\@secondoftwo\string}%
    \expandafter\@firstoftwo\expandafter{\iffalse}\fi0 #3}{0 #2}%
  }%
}%
%%---------------------------------------------------------------
%% Selecting appropriate unit-component from data-array:
%%...............................................................
% It is assumed that units come from an array
% consisting of three components/elements/_macro-arguments:
%  {<base unit>}%
%  {<derived unit>}%
%  {<traditional unit>}%
% Thus the "unit-selecting"-macros need to get either the first or the second
% or the third argument of three arguments;
\newcommand*\selectbaseunit[3]{#1}
\newcommand*\selectderivedunit[3]{#2}
\newcommand*\selectalternativeunit[3]{#3}
% \selectunit will select the unit and when doing so, it will
% be redefined via \let to equal either \selectbaseunit or
% \selectderivedunit or \selectalternateunit or \selectmathsymbol:
\newcommand*\selectunit{}
% "Switches" to "tell"  \selectunit which sort of unit to select:
\newcommand*\perpusebaseunit{\let\selectunit=\selectbaseunit}
\newcommand*\perpusederivedunit{\let\selectunit=\selectderivedunit}
\newcommand*\perpusealternativeunit{\let\selectunit=\selectalternativeunit}
% Localized variants of the unit selectors:
\newcommand*\hereusebaseunit[1]{\begingroup\perpusebaseunit#1\endgroup}%
\newcommand*\hereusederivedunit[1]{\begingroup\perpusederivedunit#1\endgroup}%
\newcommand*\hereusealternativeunit[1]{\begingroup\perpusealternativeunit#1\endgroup}%
% Environment variants of the unit-selectors:
\newenvironment{usebaseunit}{\perpusebaseunit}{}%
\newenvironment{usederivedunit}{\perpusederivedunit}{}%
\newenvironment{usealternativeunit}{\perpusealternativeunit}{}%
% Defining a new physical quantity.
\newcommand*\newphysicsquantity{\definephysicsquantity{\newcommand}}
\newcommand*\redefinephysicsquantity{\definephysicsquantity{\renewcommand}}
\newcommandx*\definephysicsquantity[5][4=,5=]{%
  \innerdefinewhatsoeverquantityfork{#3}{#4}{#5}{#1}{#2}{}{[1]}{##1}%
}%
% Defining a new physical constant
\newcommand*\newphysicsconstant{\definephysicsconstant{\newcommand}}
\newcommand*\redefinephysicsconstant{\definephysicsconstant{\renewcommand}}
\newcommandx*\definephysicsconstant[7][6=,7=]{%
  \innerdefinewhatsoeverquantityfork{#5}{#6}{#7}{#1}{#2}{#3}{}{#4}%
}%
% Internal macros for defining quantities and constants.
\newcommand*\innerdefinewhatsoeverquantityfork[3]{%
  \expandafter\innerdefinewhatsoeverquantity\romannumeral0%
  \mi@forkifnull{#3}{\mi@forkifnull{#2}{{#1}}{{#2}}{#1}}{\mi@forkifnull{#2}{{#1}}{{#2}}{#3}}{#1}%
}%
\newcommand*\innerdefinewhatsoeverquantity[8]{%
  \mi@name#4{#5}#7{\unit{#8}{\selectunit{#3}{#1}{#2}}}%
  \mi@name#4{#5baseunit}#7{\unit{#8}{#3}}%
  \mi@name#4{#5derivedunit}#7{\unit{#8}{#1}}%
  \mi@name#4{#5alternativeunit}#7{\unit{#8}{#2}}%
  \mi@name#4{#5onlyunit}{\selectunit{#3}{#1}{#2}}%
  \mi@name#4{#5onlybaseunit}{\ensuremath{#3}}%
  \mi@name#4{#5onlyderivedunit}{\ensuremath{#1}}%
  \mi@name#4{#5onlyalternativeunit}{\ensuremath{#2}}%
  \mi@name#4{#5value}#7{\ensuremath{#8}}%
  \mi@forkifnull{#7}{%
    \ifx#4\renewcommand\mi@name\let{#5mathsymbol}=\relax\fi
    \mi@name\newcommand*{#5mathsymbol}{\ensuremath{#6}}}{}}%
%\makeatother

% Use options to select units.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifmandi@baseunits
  \perpusebaseunit
\fi
\ifmandi@derivedunits
  \perpusederivedunit
\fi  
\ifmandi@alternateunits
  \perpusealternativeunit
\fi
\ifmandi@exactconstants
  \newcommand*{\mi@p}[2]{#2} % exact constants
\else
  \newcommand*{\mi@p}[2]{#1} % approximate constants
\fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%  Define every quantity we need in introductory physics alphabetically.
\newphysicsquantity{acceleration}%
  {\meter\usk\second\reciprocalsquared}%
  [\newton\per\kilogram]%
  [\meter\per\second\squared]%
\newphysicsquantity{amount}%
  {\mole}%
  []%
  []%
\newphysicsquantity{angularvelocity}%
  {\radian\usk\reciprocal\second}%
  [\radian\per\second]%
  [\radian\per\second]%
\newphysicsquantity{angularacceleration}%
  {\radian\usk\second\reciprocalsquared}%
  [\radian\per\second\squared]%
  [\radian\per\second\squared]%
\newphysicsquantity{angularfrequency}%
  {\radian\usk\reciprocal\second}%
  [\radian\per\second]%
  [\radian\per\second]%
\ifmandi@rotradians
  \newphysicsquantity{angularimpulse}%
    {\meter\squared\usk\kilogram\usk\reciprocal\second\usk\reciprocal\radian}%
    [\joule\usk\second\per\radian]%
    [\newton\usk\meter\usk\second\per\radian]%
  \newphysicsquantity{angularmomentum}%
    {\meter\squared\usk\kilogram\usk\reciprocal\second\usk\reciprocal\radian}%
    [\kilogram\usk\meter\squared\per(\second\usk\radian)]%
    [\newton\usk\meter\usk\second\per\radian]%
\else
  \newphysicsquantity{angularimpulse}%
    {\meter\squared\usk\kilogram\usk\reciprocal\second}%
    [\kilogram\usk\meter\squared\per\second]% % also \joule\usk\second
    [\kilogram\usk\meter\squared\per\second]% % also \newton\usk\meter\usk\second
  \newphysicsquantity{angularmomentum}%
    {\meter\squared\usk\kilogram\usk\reciprocal\second}%
    [\kilogram\usk\meter\squared\per\second]% % also \joule\usk\second
    [\kilogram\usk\meter\squared\per\second]% % also \newton\usk\meter\usk\second
\fi
\newphysicsquantity{area}%
  {\meter\squared}%
  []%
  []%
\newphysicsquantity{areamassdensity}%
  {\meter\reciprocalsquared\usk\kilogram}%
  [\kilogram\per\meter\squared]%
  [\kilogram\per\meter\squared]%
\newphysicsquantity{areachargedensity}%
  {\reciprocalsquare\meter\usk\second\usk\ampere}%
  [\coulomb\per\square\meter]%
  [\coulomb\per\square\meter]%
\newphysicsquantity{capacitance}%
  {\reciprocalsquare\meter\usk\reciprocal\kilogram\usk\quartic\second\usk\square\ampere}%
  [\farad]%
  [\coulomb\per\volt]% % also \coulomb\squared\per\newton\usk\meter, \second\per\ohm
\newphysicsquantity{charge}%
  {\ampere\usk\second}%
  [\coulomb]%
  [\coulomb]% % also \farad\usk\volt
\newphysicsquantity{cmagneticfield}%
  {\meter\usk\kilogram\usk\second\reciprocalcubed\usk\reciprocal\ampere}%
  [\volt\per\meter]%
  [\newton\per\coulomb]%
\newphysicsquantity{conductance}%
  {\reciprocalsquare\meter\usk\reciprocal\kilogram\usk\cubic\second\usk\square\ampere}%
  [\siemens]%
  [\ampere\per\volt]%
\newphysicsquantity{conductivity}%
  {\reciprocalcubic\meter\usk\reciprocal\kilogram\usk\cubic\second\usk\square\ampere}%
  [\siemens\per\meter]%
  [(\ampere\per\square\meter)\per(\volt\per\meter)]%
\newphysicsquantity{conventionalcurrent}%
  {\ampere}%
  [\coulomb\per\second]%
  [\ampere]%
\newphysicsquantity{current}%
  {\ampere}%
  []%
  []%
\newphysicsquantity{currentdensity}%
  {\reciprocalsquare\meter\usk\ampere}%
  [\coulomb\usk\second\per\square\meter]%
  [\ampere\per\square\meter]%
\newphysicsquantity{displacement}%
  {\meter}
  []
  []
\newphysicsquantity{duration}%
  {\second}%
  []%
  []%
\newphysicsquantity{dielectricconstant}%
  {}%
  []%
  []%
\newphysicsquantity{electricdipolemoment}%
  {\meter\usk\second\usk\ampere}%
  [\coulomb\usk\meter]%
  [\coulomb\usk\meter]%
\newphysicsquantity{electricfield}%
  {\meter\usk\kilogram\usk\second\reciprocalcubed\usk\reciprocal\ampere}%
  [\volt\per\meter]%
  [\newton\per\coulomb]%
\newphysicsquantity{electricflux}%
  {\meter\cubed\usk\kilogram\usk\second\reciprocalcubed\usk\reciprocal\ampere}%
  [\volt\usk\meter]%
  [\newton\usk\meter\squared\per\coulomb]%
\newphysicsquantity{electricpotential}%
  {\square\meter\usk\kilogram\usk\reciprocalcubic\second\usk\reciprocal\ampere}%
  [\volt]%
  [\joule\per\coulomb]%
\newphysicsquantity{electroncurrent}%
  {\reciprocal\second}%
  [\ensuremath{\symup{e}}\per\second]%
  [\ensuremath{\symup{e}}\per\second]%
\newphysicsquantity{emf}%
  {\square\meter\usk\kilogram\usk\reciprocalcubic\second\usk\reciprocal\ampere}%
  [\volt]%
  [\joule\per\coulomb]%
\newphysicsquantity{energy}%
  {\meter\squared\usk\kilogram\usk\second\reciprocalsquared}%
  [\joule]% % also \newton\usk\meter
  [\joule]%
\newphysicsquantity{energydensity}%
  {\meter\reciprocaled\usk\kilogram\usk\reciprocalsquare\second}%
  [\joule\per\cubic\meter]%
  [\joule\per\cubic\meter]%
\newphysicsquantity{energyflux}%
  {\kilogram\usk\second\reciprocalcubed}%
  [\watt\per\meter\squared]%
  [\watt\per\meter\squared]%
\newphysicsquantity{entropy}%
  {\meter\squared\usk\kilogram\usk\second\reciprocalsquared\usk\reciprocal\kelvin}%
  [\joule\per\kelvin]%
  [\joule\per\kelvin]%
\newphysicsquantity{frequency}%
  {\reciprocal\second}%
  [\hertz]%
  [\hertz]%
\newphysicsquantity{force}%
  {\meter\usk\kilogram\usk\second\reciprocalsquared}%
  [\newton]%
  [\newton]% % also \kilogram\usk\meter\per\second\squared
\newphysicsquantity{gravitationalfield}%
  {\meter\usk\second\reciprocalsquared}%
  [\newton\per\kilogram]%
  [\newton\per\kilogram]%
\newphysicsquantity{gravitationalpotential}%
  {\square\meter\usk\reciprocalsquare\second}%
  [\joule\per\kilogram]%
  [\joule\per\kilogram]%
\newphysicsquantity{impulse}%
  {\meter\usk\kilogram\usk\reciprocal\second}%
  [\newton\usk\second]%
  [\newton\usk\second]%
\newphysicsquantity{indexofrefraction}%
  {}%
  []%
  []%
\newphysicsquantity{inductance}%
  {\square\meter\usk\kilogram\usk\reciprocalsquare\second\usk\reciprocalsquare\ampere}%
  [\henry]%
  [\volt\usk\second\per\ampere]% % also \square\meter\usk\kilogram\per\coulomb\squared, \Wb\per\ampere
\newphysicsquantity{linearchargedensity}%
  {\reciprocal\meter\usk\second\usk\ampere}%
  [\coulomb\per\meter]%
  [\coulomb\per\meter]%
\newphysicsquantity{linearmassdensity}%
  {\reciprocal\meter\usk\kilogram}%
  [\kilogram\per\meter]%
  [\kilogram\per\meter]%
\newphysicsquantity{luminous}%
  {\candela}%
  []%
  []%
\newphysicsquantity{magneticcharge}%
  {\meter\usk\ampere}%
  []%
  []%
\newphysicsquantity{magneticdipolemoment}%
  {\square\meter\usk\ampere}%
  [\ampere\usk\square\meter]%
  [\joule\per\tesla]%
\newphysicsquantity{magneticfield}%
  {\kilogram\usk\second\reciprocalsquared\usk\reciprocal\ampere}%
  [\tesla]%
  [\newton\per\coulomb\usk(\meter\per\second)]% % also \Wb\per\meter\squared
\newphysicsquantity{magneticflux}%
  {\meter\squared\usk\kilogram\usk\second\reciprocalsquared\usk\reciprocal\ampere}%
  [\tesla\usk\meter\squared]%
  [\volt\usk\second]% % also \Wb and \joule\per\ampere
\newphysicsquantity{mass}%
  {\kilogram}%
  []%
  []%
\newphysicsquantity{mobility}%
  {\meter\squared\usk\kilogram\usk\second\reciprocalquarted\usk\reciprocal\ampere}%
  [\meter\squared\per\volt\usk\second]%
  [(\meter\per\second)\per(\newton\per\coulomb)]%
\newphysicsquantity{momentum}%
  {\meter\usk\kilogram\usk\reciprocal\second}%
  [\newton\usk\second]%
  [\kilogram\usk\meter\per\second]%
\newphysicsquantity{momentumflux}%
  {\reciprocal\meter\usk\kilogram\usk\second\reciprocalsquared}%
  [\newton\per\meter\squared]%
  [\newton\per\meter\squared]%
\newphysicsquantity{momentofinertia}%
  {\meter\squared\usk\kilogram}%
  [\joule\usk\second\squared]%
  [\meter\squared\usk\kilogram]%
\newphysicsquantity{numberdensity}%
  {\reciprocalcubic\meter}%
  [\per\cubic\meter]%
  [\per\cubic\meter]%
\newphysicsquantity{permeability}%
  {\meter\usk\kilogram\usk\second\reciprocalsquared\usk\ampere\reciprocalsquared}%
  [\tesla\usk\meter\per\ampere]%
  [\henry\per\meter]%
\newphysicsquantity{permittivity}%
  {\meter\reciprocalcubed\usk\reciprocal\kilogram\usk\second\reciprocalquarted\usk\ampere\squared}%
  [\farad\per\meter]%
  [\coulomb\squared\per\newton\usk\meter\squared]%
\newphysicsquantity{planeangle}%
  {\meter\usk\reciprocal\meter}%
  [\radian]%
  [\radian]%
\newphysicsquantity{polarizability}%
  {\reciprocal\kilogram\usk\second\quarted\usk\square\ampere}%
  [\coulomb\usk\square\meter\per\volt]%
  [\coulomb\usk\meter\per(\newton\per\coulomb)]%
\newphysicsquantity{power}%
  {\meter\squared\usk\kilogram\usk\second\reciprocalcubed}%
  [\watt]%
  [\joule\per\second]%
\newphysicsquantity{pressure}%
  {\reciprocal\meter\usk\kilogram\usk\second\reciprocalsquared}%
  [\pascal]%
  [\newton\per\meter\squared]%
\newphysicsquantity{relativepermeability}
  {}%
  []%
  []%
\newphysicsquantity{relativepermittivity}%
  {}%
  []%
  []%
\newphysicsquantity{resistance}%
  {\square\meter\usk\kilogram\usk\reciprocalcubic\second\usk\reciprocalsquare\ampere}%
  [\volt\per\ampere]%
  [\ohm]%
\newphysicsquantity{resistivity}%
  {\cubic\meter\usk\kilogram\usk\reciprocalcubic\second\usk\reciprocalsquare\ampere}%
  [\ohm\usk\meter]%
  [(\volt\per\meter)\per(\ampere\per\square\meter)]%
\newphysicsquantity{solidangle}%
  {\meter\squared\usk\reciprocalsquare\meter}%
  [\steradian]%
  [\steradian]%
\newphysicsquantity{specificheatcapacity}%
  {\meter\squared\usk\second\reciprocalsquared\usk\reciprocal\kelvin}%
  [\joule\per\kelvin\usk\kilogram]%
  [\joule\per\kelvin\usk\kilogram]
\newphysicsquantity{springstiffness}%
  {\kilogram\usk\second\reciprocalsquared}%
  [\newton\per\meter]%
  [\newton\per\meter]%
\newphysicsquantity{springstretch}% % This is really just a displacement.
  {\meter}%
  []%
  []%
\newphysicsquantity{stress}%
  {\reciprocal\meter\usk\kilogram\usk\second\reciprocalsquared}%
  [\pascal]%
  [\newton\per\meter\squared]%
\newphysicsquantity{strain}%
  {}%
  []%
  []%
\newphysicsquantity{temperature}%
  {\kelvin}%
  []%
  []%
\ifmandi@rotradians
  \newphysicsquantity{torque}%
    {\meter\squared\usk\kilogram\usk\second\reciprocalsquared\usk\reciprocal\radian}%
    [\newton\usk\meter\per\radian]%
    [\newton\usk\meter\per\radian]%
\else
  \newphysicsquantity{torque}%
    {\meter\squared\usk\kilogram\usk\second\reciprocalsquared}%
    [\newton\usk\meter]%
    [\newton\usk\meter]%
\fi
\newphysicsquantity{velocity}%
  {\meter\usk\reciprocal\second}%
  [\meter\usk\reciprocal\second]%
  [\meter\per\second]%
\newphysicsquantity{volume}%
  {\cubic\meter}%
  []%
  []%
\newphysicsquantity{volumechargedensity}%
  {\reciprocalcubic\meter\usk\second\usk\ampere}%
  [\coulomb\per\cubic\meter]%
  [\coulomb\per\cubic\meter]%
\newphysicsquantity{volumemassdensity}%
  {\meter\reciprocalcubed\usk\kilogram}%
  [\kilogram\per\meter\cubed]%
  [\kilogram\per\meter\cubed]%
\newphysicsquantity{wavelength}% % This is really just a displacement.
  {\meter}%
  []%
  []%
\newphysicsquantity{wavenumber}%
  {\reciprocal\meter}%
  [\per\meter]%
  [\per\meter]%
\newphysicsquantity{work}%
  {\meter\squared\usk\kilogram\usk\second\reciprocalsquared}%
  [\joule]%
  [\newton\usk\meter]%
\newphysicsquantity{youngsmodulus}% % This is really just a stress.
  {\reciprocal\meter\usk\kilogram\usk\second\reciprocalsquared}%
  [\pascal]%
  [\newton\per\meter\squared]%
\newcommand*{\vectoracceleration}[1]{\ensuremath{\acceleration{\mivector{#1}}}}
\newcommand*{\vectorangularacceleration}[1]
  {\ensuremath{\angularacceleration{\mivector{#1}}}}
\newcommand*{\vectorangularimpulse}[1]{\ensuremath{\angularimpulse{\mivector{#1}}}}
\newcommand*{\vectorangularmomentum}[1]{\ensuremath{\angularmomentum{\mivector{#1}}}}
\newcommand*{\vectorangularvelocity}[1]{\ensuremath{\angularvelocity{\mivector{#1}}}}
\newcommand*{\vectorcmagneticfield}[1]{\ensuremath{\cmagneticfield{\mivector{#1}}}}
\newcommand*{\vectorcurrentdensity}[1]{\ensuremath{\currentdensity{\mivector{#1}}}}
\newcommand*{\vectordisplacement}[1]{\ensuremath{\displacement{\mivector{#1}}}}
\newcommand*{\vectorelectricdipolemoment}[1]
  {\ensuremath{\electricdipolemoment{\mivector{#1}}}}
\newcommand*{\vectorelectricfield}[1]{\ensuremath{\electricfield{\mivector{#1}}}}
\newcommand*{\vectorenergyflux}[1]{\ensuremath{\energyflux{\mivector{#1}}}}
\newcommand*{\vectorforce}[1]{\ensuremath{\force{\mivector{#1}}}}
\newcommand*{\vectorgravitationalfield}[1]
  {\ensuremath{\gravitationalfield{\mivector{#1}}}}
\newcommand*{\vectorimpulse}[1]{\ensuremath{\impulse{\mivector{#1}}}}
\newcommand*{\vectormagneticdipolemoment}[1]
  {\ensuremath{\magneticdipolemoment{\mivector{#1}}}}
\newcommand*{\vectormagneticfield}[1]{\ensuremath{\magneticfield{\mivector{#1}}}}
\newcommand*{\vectormomentum}[1]{\ensuremath{\momentum{\mivector{#1}}}}
\newcommand*{\vectormomentumflux}[1]{\ensuremath{\momentumflux{\mivector{#1}}}}
\newcommand*{\poyntingvector}{\vectorenergyflux}
\newcommand*{\vectortorque}[1]{\ensuremath{\torque{\mivector{#1}}}}
\newcommand*{\vectorvelocity}[1]{\ensuremath{\velocity{\mivector{#1}}}}
\newcommand*{\vectorvelocityc}[1]{\ensuremath{\velocityc{\mivector{#1}}}}
\newcommand*{\vectorwavenumber}[1]{\ensuremath{\wavenumber{\mivector{#1}}}}

%  Define physical constants for introductory physics alphabetically.
\newphysicsconstant{avogadro}%
  {\ensuremath{N_A}}%
  {\mi@p{6.0}{6.022140857}\timestento{23}}%
  {\reciprocal\mole}%
  [\reciprocal\mole]%
  [\reciprocal\mole]%
\newphysicsconstant{bohrradius}%
  {\ensuremath{a_0}}%
  {\mi@p{5.3}{5.2917721067}\timestento{-11}}%
  {\meter}%
  [\meter]%
  [\meter]%
\newphysicsconstant{boltzmann}%
  {\ensuremath{k_B}}%
  {\mi@p{1.4}{1.38064852}\timestento{-23}}%
  {\meter\squared\usk\kilogram\usk\reciprocalsquare\second\usk\reciprocal\kelvin}%
  [\joule\per\kelvin]%
  [\joule\per\kelvin]%
\newphysicsconstant{clight}%
  {\ensuremath{c}}%
  {\mi@p{3}{2.99792458}\timestento{8}}%
  {\meter\usk\reciprocal\second}%
  [\meter\per\second]%
  [\meter\per\second]
\newphysicsconstant{earthmass}%
  {\ensuremath{M_{\symup{Earth}}}}%
  {\mi@p{6.0}{5.97237}\timestento{24}}%
  {\kilogram}%
  [\kilogram]%
  [\kilogram]%
\newphysicsconstant{earthmoondistance}%
  {\ensuremath{d_{\symup{EM}}}}%
  {\mi@p{3.8}{3.81550}\timestento{8}}%
  {\meter}%
  [\meter]%
  [\meter]%
\newphysicsconstant{earthradius}%
  {\ensuremath{R_{\symup{Earth}}}}%
  {\mi@p{6.4}{6.371}\timestento{6}}%
  {\meter}%
  [\meter]%
  [\meter]%
\newphysicsconstant{earthsundistance}%
  {\ensuremath{d_{\symup{ES}}}}%
  {\mi@p{1.5}{1.496}\timestento{11}}%
  {\meter}%
  [\meter]%
  [\meter]%
\newphysicsconstant{electroncharge}%
  {\ensuremath{q_e}}%
  {-\elementarychargevalue}%
  {\ampere\usk\second}%
  [\coulomb]%
  [\coulomb]%
\newphysicsconstant{electronCharge}%
  {\ensuremath{Q_e}}%
  {-\elementarychargevalue}%
  {\ampere\usk\second}%
  [\coulomb]%
  [\coulomb]%
\newphysicsconstant{electronmass}%
  {\ensuremath{m_e}}%
  {\mi@p{9.1}{9.10938356}\timestento{-31}}%
  {\kilogram}%
  [\kilogram]%
  [\kilogram]%
\newphysicsconstant{elementarycharge}%
  {\ensuremath{e}}%
  {\mi@p{1.6}{1.6021766208}\timestento{-19}}%
  {\ampere\usk\second}%
  [\coulomb]%
  [\coulomb]%
\newphysicsconstant{finestructure}%
  {\ensuremath{\alpha}}%
  {\mi@p{\frac{1}{137}}{7.2973525664\timestento{-3}}}%
  {}%
  []%
  []%
\newphysicsconstant{hydrogenmass}%
  {\ensuremath{m_H}}%
  {\mi@p{1.7}{1.6737236}\timestento{-27}}%
  {\kilogram}%
  [\kilogram]%
  [\kilogram]%
\newphysicsconstant{moonearthdistance}%
  {\ensuremath{d_{\symup{ME}}}}%
  {\mi@p{3.8}{3.81550}\timestento{8}}%
  {\meter}%
  [\meter]%
  [\meter]%
\newphysicsconstant{moonmass}%
  {\ensuremath{M_{\symup{Moon}}}}%
  {\mi@p{7.3}{7.342}\timestento{22}}%
  {\kilogram}%
  [\kilogram]%
  [\kilogram]%
\newphysicsconstant{moonradius}%
  {\ensuremath{R_{\symup{Moon}}}}%
  {\mi@p{1.7}{1.7371}\timestento{6}}%
  {\meter}%
  [\meter]%
  [\meter]%
\newphysicsconstant{mzofp}%
  {\ensuremath{\frac{\mu_o}{4\pi}}}%
  {\tento{-7}}%
  {\meter\usk\kilogram\usk\second\reciprocalsquared\usk\ampere\reciprocalsquared}%
  [\henry\per\meter]%
  [\tesla\usk\meter\per\ampere]%
\newphysicsconstant{neutronmass}%
  {\ensuremath{m_n}}%
  {\mi@p{1.7}{1.674927471}\timestento{-27}}%
  {\kilogram}%
  [\kilogram]%
  [\kilogram]%
\newphysicsconstant{oofpez}%
  {\ensuremath{\frac{1}{4\pi\epsilon_o}}}%
  {\mi@p{9}{8.9875517873681764}\timestento{9}}%
  {\meter\cubed\usk\kilogram\usk\reciprocalquartic\second\usk\ampere\reciprocalsquared}%
  [\meter\per\farad]%
  [\newton\usk\meter\squared\per\coulomb\squared]%
\newphysicsconstant{oofpezcs}%
  {\ensuremath{\frac{1}{4\pi\epsilon_o c^2}}}%
  {\tento{-7}}%
  {\meter\usk\kilogram\usk\second\reciprocalsquared\usk\ampere\reciprocalsquared}%
  [\tesla\usk\meter\squared]%
  [\newton\usk\second\squared\per\coulomb\squared]%
\newphysicsconstant{planck}%
  {\ensuremath{h}}%
  {\mi@p{6.6}{6.626070040}\timestento{-34}}%
  {\meter\squared\usk\kilogram\usk\reciprocal\second}%
  [\joule\usk\second]%
  [\joule\usk\second]%
\newphysicsconstant{planckbar}%
  {\ensuremath{\hslash}}%
  {\mi@p{1.1}{1.054571800}\timestento{-34}}%
  {\meter\squared\usk\kilogram\usk\reciprocal\second}%
  [\joule\usk\second]%
  [\joule\usk\second]
\newphysicsconstant{planckc}%
  {\ensuremath{hc}}%
  {\mi@p{2.0}{1.98644568}\timestento{-25}}%
  {\meter\cubed\usk\kilogram\usk\reciprocalsquare\second}%
  [\joule\usk\meter]%
  [\joule\usk\meter]%
\newphysicsconstant{protoncharge}%
  {\ensuremath{q_p}}%
  {+\elementarychargevalue}%
  {\ampere\usk\second}%
  [\coulomb]%
  [\coulomb]%
\newphysicsconstant{protonCharge}%
  {\ensuremath{Q_p}}%
  {+\elementarychargevalue}%
  {\ampere\usk\second}%
  [\coulomb]%
  [\coulomb]%
\newphysicsconstant{protonmass}%
  {\ensuremath{m_p}}%
  {\mi@p{1.7}{1.672621898}\timestento{-27}}%
  {\kilogram}%
  [\kilogram]%
  [\kilogram]%
\newphysicsconstant{rydberg}%
  {\ensuremath{R_{\infty}}}%
  {\mi@p{1.1}{1.0973731568508}\timestento{7}}%
  {\reciprocal\meter}%
  [\reciprocal\meter]%
  [\reciprocal\meter]%
\newphysicsconstant{stefanboltzmann}%
  {\ensuremath{\sigma}}%
  {\mi@p{5.7}{5.670367}\timestento{-8}}%
  {\kilogram\usk\second\reciprocalcubed\usk\kelvin\reciprocalquarted}%
  [\watt\per\meter\squared\usk\kelvin\quarted]%
  [\watt\per\meter\squared\usk\kelvin\quarted]
\newphysicsconstant{sunearthdistance}%
  {\ensuremath{d_{\symup{SE}}}}%
  {\mi@p{1.5}{1.496}\timestento{11}}%
  {\meter}%
  [\meter]%
  [\meter]%
\newphysicsconstant{sunmass}%
  {\ensuremath{M_{\symup{Sun}}}}%
  {\mi@p{2.0}{1.98855}\timestento{30}}%
  {\kilogram}%
  [\kilogram]%
  [\kilogram]%
\newphysicsconstant{sunradius}%
  {\ensuremath{R_{\symup{Sun}}}}%
  {\mi@p{7.0}{6.957}\timestento{8}}%
  {\meter}%
  [\meter]%
  [\meter]%
\newphysicsconstant{surfacegravfield}%
  {\ensuremath{g}}%
  {\mi@p{9.8}{9.807}}%
  {\meter\usk\second\reciprocalsquared}%
  [\newton\per\kilogram]%
  [\newton\per\kilogram]%
\newphysicsconstant{universalgrav}%
  {\ensuremath{G}}%
  {\mi@p{6.7}{6.67408}\timestento{-11}}%
  {\meter\cubed\usk\reciprocal\kilogram\usk\second\reciprocalsquared}%
  [\newton\usk\meter\squared\per\kilogram\squared]% % also \joule\usk\meter\per\kilogram\squared
  [\newton\usk\meter\squared\per\kilogram\squared]%
\newphysicsconstant{vacuumpermeability}%
  {\ensuremath{\mu_o}}%
  {4\pi\timestento{-7}}%
  {\meter\usk\kilogram\usk\second\reciprocalsquared\usk\ampere\reciprocalsquared}%
  [\henry\per\meter]%
  [\tesla\usk\meter\per\ampere]%
\newphysicsconstant{vacuumpermittivity}%
  {\ensuremath{\epsilon_o}}%
  {\mi@p{9.0}{8.854187817}\timestento{-12}}%
  {\meter\reciprocalcubed\usk\reciprocal\kilogram\usk\second\quarted\usk\ampere\squared}%
  [\farad\per\meter]%
  [\coulomb\squared\per\newton\usk\meter\squared]%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Highlighting in mathematical expressions.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcounter{tikzhighlightnode}
\NewDocumentCommand{\hilite}{ O{magenta!60} m O{rectangle} }{%
  % Original code by anonymous user abcdefg, modified by me.
  % See https://texample.net/tikz/examples/beamer-arrows/
  % See also https://tex.stackexchange.com/a/406084/218142
  % See also https://tex.stackexchange.com/a/570858/218142
  % See also https://tex.stackexchange.com/a/570789/218142
  % See also https://tex.stackexchange.com/a/79659/218142
  % See also https://tex.stackexchange.com/q/375032/218142
  % See also https://tex.stackexchange.com/a/571744/218142
  \stepcounter{tikzhighlightnode}%
  \tikzmarknode{highlighted-node-\number\value{tikzhighlightnode}}{#2}%
  \edef\temp{%
    \noexpand\AddToShipoutPictureBG{%
      \noexpand\begin{tikzpicture}[overlay,remember picture]%
      \noexpand\iftikzmarkoncurrentpage{highlighted-node-\number\value{tikzhighlightnode}}%
       \noexpand\node[inner sep=1.0pt,fill=#1,#3,fit=(highlighted-node-\number\value{tikzhighlightnode})]{};%
      \noexpand\fi
      \noexpand\end{tikzpicture}%
    }%
  }%
  \temp%
}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Intelligent delimiters provided via the mathtools package.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Use starred version for fractions. Can also take optional sizes.
\DeclarePairedDelimiterX{\norm}[1]{\lVert}{\rVert}{\ifblank{#1}{\:\cdot\:}{#1}}
\DeclarePairedDelimiterX{\absv}[1]{\lvert}{\rvert}{\ifblank{#1}{\:\cdot\:}{#1}}
\DeclarePairedDelimiterX{\angs}[1]{\langle}{\rangle}{\ifblank{#1}{\:\cdot\:}{#1}}
\DeclarePairedDelimiterX{\pens}[1]{(}{)}{\ifblank{#1}{\:\cdot\:}{#1}}
\DeclarePairedDelimiterX{\dims}[1]{[}{]}{\ifblank{#1}{\:\cdot\:}{#1}}
\DeclarePairedDelimiterX{\unts}[1]{\{}{\}}{\ifblank{#1}{\:\cdot\:}{#1}}

% These are revised.
\NewDocumentCommand{\innorm}{ O{\:\cdot\:} }{%
  \left\lVert#1\right\rVert
}%
\NewDocumentCommand{\inabsv}{ O{\:\cdot\:} }{%
  \left\lvert#1\right\rvert
}%
\NewDocumentCommand{\inangs}{ O{\:\cdot\:} }{%
  \left\langle#1\right\rangle
}%
\NewDocumentCommand{\inpens}{ O{\:\cdot\:} }{%
  \left(#1\right)
}%
\NewDocumentCommand{\indims}{ O{\:\cdot\:} }{%
  \left[#1\right]
}%
\NewDocumentCommand{\inunts}{ O{\:\cdot\:} }{%
  \left\{#1\right\}
}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Declare some new math operators.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \dim operator is already defined in amsmath.
\DeclareMathOperator{\abs}{abs}
\DeclareMathOperator{\units}{units}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Redefine some commands to account for index notation.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% We need some good semantic commands to distinguish index notation
%  from coordinate free notation. These are experimental.
%  Use starred form for index notation, regular form for coordinate-free.
\NewDocumentCommand{\veccomp}{ s m }{%
  % Consider renaming this to \vectorsym.
  \IfBooleanTF{#1}
  {% We have a *.
    \ensuremath{\symnormal{#2}}%
  }%
  {% We don't have a *.
    \ensuremath{\symbfit{#2}}%
  }%
}%
\NewDocumentCommand{\tencomp}{ s m }{%
  % Consider renaming this to \tensororsym.
  \IfBooleanTF{#1}
  {% We have a *.
    \ensuremath{\symsfit{#2}}%
  }%
  {% We don't have a *.
    \ensuremath{\symbfsfit{#2}}%
  }%
}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% We need some custom commands for coordinate-free tensors.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This is an intelligent slot command for coordinate-free tensor notation.
%  \newcommand*{\slot}[1][~]{\,\underline{\smash{\makebox[1.5em]{\ensuremath{#1}}}}\,}
%  \slot       gives just a blank slot 1.0em wide.
%  \slot[...]  fills the slot with a vector but doesn't show the slot.
%  \slot*[...] fills the slot but does show the slot.
%  \slot*      isn't defined and shouldn't be used even though it doesn't 
%               throw an error.
\NewDocumentCommand{\slot}{ s d[] }{%
  % d[] must be used because of the way consecutive optional
  %  arguments are handled. See xparse docs for details.
  \IfBooleanTF{#1}
  {% We have a *.
    \IfValueT{#2}
    {% Insert a vector, and show the slot.
      \underline{\smash{\makebox[1.5em]{\ensuremath{#2}}}}
    }%
  }%
  {% We don't have a *.
    \IfValueTF{#2}
    {% Insert a vector, but don't show the slot.
      \smash{\makebox[1.5em]{\ensuremath{#2}}}
    }%
    {% No vector; just show the slot.
      \underline{\smash{\makebox[1.5em]{\ensuremath{}}}}
    }%
  }%
}%

% Notation for contraction on pairs of slots.
%\newcommand*{\contraction}[1]{\mathbbmss{C}_{#1}}
%\newcommand*{\contraction}[1]{C_{#1}}
\NewDocumentCommand{\contraction}{ s m }{%
  \IfBooleanTF{#1}
  {\mathsf{C}}% We have a *.
  {\symbb{C}}% We don't have a *.
  _{#2}
}%
%\NewDocumentCommand{\contraction}{ s m }{%
%  \IfBooleanTF {#1} % check for *
%  {% Use C for contraction.
%    \mathsf{C}_{#2}
%  }%
%  {%
%    \symbb{C}_{#2}
%  }%  
%}%

% An intelligent exterior derivative operator.
\NewDocumentCommand{\dd}{ s }{%
  \mathop{}\!
  \IfBooleanTF{#1}
  {\symbfsfup{d}}% We have a *.
  {\symsfup{d}}% We don't have a *.
}%
%\NewDocumentCommand{\dd}{ s }{%
%  \IfBooleanTF{#1}
%  {% We have a *.
%    \mathop{}\!\symbfsfup{d}
%  }%
%  {% We don't have a *.
%    \mathop{}\!\symsfup{d}
%  }%
%}%

% The zero vector.
\DeclareRobustCommand{\zerovector}{\symbfup{0}}

% Notation for tensor valence.
%  \binom looks terrible in inline math!
%  See https://tex.stackexchange.com/q/269980/218142
%\newcommand*{\valence}[2]{\ensuremath{\binom{#1}{#2}}}
%  Works, but still sucks.
\newcommand*{\valence}[2]{\ensuremath{\Bigl(\genfrac{}{}{0pt}{}{#1}{#2}\Bigr)}}
%  Switch to horizontal.
%\newcommand*{\valence}[2]{\ensuremath{(#1,#2)}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Column and Row Vectors
%  See https://tex.stackexchange.com/a/39054/218142
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ExplSyntaxOn
\NewDocumentCommand{\colvec}{ O{,} m }{%
  \vector_main:nnnn { p } { \\ } { #1 } { #2 }
}%

\NewDocumentCommand{\rowvec}{ O{,} m }{%
  \vector_main:nnnn { p } { & } { #1 } { #2 }
}%

\seq_new:N \l__vector_arg_seq
\cs_new_protected:Npn \vector_main:nnnn #1 #2 #3 #4 {%
  \seq_set_split:Nnn \l__vector_arg_seq { #3 } { #4 }
  \begin{#1NiceMatrix}[r]
    \seq_use:Nnnn \l__vector_arg_seq { #2 } { #2 } { #2 }
  \end{#1NiceMatrix}
}%
\ExplSyntaxOff
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Intelligent Coordinate-Free \vec Command.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Why doesn't it work when I put spaces around #3 or #4?
%  Because outside of \ExplSyntaxOn...\ExplSyntaxOff, 
%  the _ character has a different catcode.
%  See https://tex.stackexchange.com/q/554706/218142
%  Also see https://tex.stackexchange.com/a/531037/218142
%  This needs to incorporate ISO 80000-2.
\RenewDocumentCommand{\vec}{ s m e{_^} }{%
  \ensuremath{%
    % Note the \, used to make superscript look better.
    \IfBooleanTF {#1}        % check for *
      {\vv{#2}%  % * gives an arrow
         % Use \sp{} primitive for superscript.
         % Adjust superscript for the arrow.
         \sp{\IfValueT{#4}{\,#4}\vphantom{\smash[t]{\big|}}}
      }%         
      {\symbfit{#2}  % no * gives us bold
         % Use \sp{} primitive for superscript.
         % No superscript adjustment needed.
         \sp{\IfValueT{#4}{#4}\vphantom{\smash[t]{\big|}}}
      }% 
    % Use \sb{} primitive for subscript.
    \sb{\IfValueT{#3}{#3}\vphantom{\smash[b]{|}}}
  }%
}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Symbolic vector commands.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\NewDocumentCommand{\Dvect}{ s m }{%
  \Delta
  \IfBooleanTF{#1}
    {\vec*}%
    {\vec}%
  {#2}
}%
\NewDocumentCommand{\dirvect}{ s m }{%
  % A slight tweak is needed to get uniform hats.
  % Requires the makebox package.
  %  See https://tex.stackexchange.com/a/391204/218142
  \widehat{\makebox*{\(p\)}{%
    \ensuremath{%
      \IfBooleanTF{#1}%
        {#2}%
        {\symbfit{#2}}%
      }%
    }%
  }%
}%
\NewDocumentCommand{\magvect}{ s m }{%
  \norm{%
    \IfBooleanTF{#1}
      {\vec*}%
      {\vec}%
    {#2}
  }%
}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Other Commands.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand*{\tento}[1]{\ensuremath{10^{#1}}}
\newcommand*{\timestento}[1]{\ensuremath{\;\times\;10^{#1}}}
\newcommand*{\xtento}{\timestento}
\newcommand*{\changein}{\Delta}
% See https://tex.stackexchange.com/q/570223/218142
\newcommand*{\reason}[2][4cm]{&&\begin{minipage}{#1}\raggedright\small #2\end{minipage}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Undocumented Diagnostic Commands.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand*{\chkquantity}[1]{%
  \begin{center}
    \begin{tabular}{>{\centering}p{4cm} >{\centering}p{3cm} >{\centering}p{3cm} >{\centering}p{3cm}}
      name & base & derived & alternate \tabularnewline
      \ttfamily\small{\expandafter\string\csname #1\endcsname} & 
      \small{\csname #1onlybaseunit\endcsname} & 
      \small{\csname #1onlyderivedunit\endcsname} &
      \small{\csname #1onlyalternativeunit\endcsname}
    \end{tabular}
  \end{center}
}%
\newcommand*{\chkconstant}[1]{%
  \begin{center}
    \begin{tabular}{>{\centering}p{4cm} >{\centering}p{4cm} >{\centering}p{4cm}}
      name  & symbol & value \tabularnewline
      \ttfamily\small{\expandafter\string\csname #1\endcsname} & 
      \small{\csname #1mathsymbol\endcsname} & 
      \small{\csname #1value\endcsname} \tabularnewline
      base & derived & alternate  \tabularnewline
      \small{\csname #1onlybaseunit\endcsname} & 
      \small{\csname #1onlyderivedunit\endcsname} &
      \small{\csname #1onlyalternativeunit\endcsname}
    \end{tabular}
  \end{center}
}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
%%
%% End of file `mandi.sty'.
